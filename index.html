<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset-Tracker</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.grey-light_blue.min.css" />
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <style>
        /* general styling */
        #wrapper {
            min-width: 340px;
            max-width: 1000px;
            margin: auto;
            padding: 50px 50px;
            height: fit-content;
        }

        .layoutElement {
            margin-top: 30px;
            margin-bottom: 60px;
        }

        p {
            display: inline-block;
        }

        /* assetForm */
        #assetForm {
            display: inline-block;
            width: 100%;
        }

        #assetForm-hidden {
            display: none;
        }

        #assetForm form {
            /* display: inline-block; */
            float: left;
        }

        #assetForm .mdl-textfield {
            width: 150px;
            margin-right: 20px;
            display: inline-block;
        }

        #assetForm .mdl-button {
            float: right;
            /* display: inline-block; */
        }

        #error {
            color: red;
            width: max-content;
        }

        /* assetFilters */
        #assetControls {
            display: inline;
        }

        #assetFilters {
            float: right;
        }

        /* assetList */
        #asset-list {
            margin-left: -10px;
            margin-right: -10px;
            display: block;
            height: fit-content;
        }

        /* assetCard */
        .demo-card-square.mdl-card {
            width: 320px;
            /* height: 320px; */
            height: 240px;
            float: left;
            margin: 10px;
        }

        .demo-card-square>.mdl-card__title {
            color: #fff;
        }

        .demo-card-square.Crypto>.mdl-card__title {
            background:
                linear-gradient(0deg, rgba(90, 90, 90, 0.5), rgba(90, 90, 90, 0.5)),
                url('images/crypto.jpg') bottom right 15% no-repeat #46B6AC;
        }

        .demo-card-square.Stocks>.mdl-card__title {
            background:
                linear-gradient(0deg, rgba(90, 90, 90, 0.5), rgba(90, 90, 90, 0.5)),
                url('images/stocks.jpg') bottom right 15% no-repeat #46B6AC;
        }

        .demo-card-square.Metals>.mdl-card__title {
            background:
                linear-gradient(0deg, rgba(90, 90, 90, 0.5), rgba(90, 90, 90, 0.5)),
                url('images/metal.jpg') bottom right 15% no-repeat #46B6AC;
        }

        .mdl-card__title-text {
            font-size: 30px;
            font-weight: 600;
        }

        .footer {
            display: block;
            width: 100%;
        }

        #total-value {
            font-size: 30px;
            font-weight: 600;
        }
    </style>

    <script>

        let ASSETS = {}
        // const ASSETS = {
        //     BTC: {
        //         assetType: 'Crypto',
        //         assetName: 'Bitcoin',
        //         assetAbb: 'BTC',
        //         assetQuantity: '1',
        //         assetUnit: 'Piece',
        //         assetValue: 1000,
        //         assetNotes: '',
        //     },
        //     AAPL: {
        //         assetType: 'Stocks',
        //         assetName: 'Apple',
        //         assetAbb: 'AAPL',
        //         assetQuantity: '1',
        //         assetUnit: 'Piece',
        //         assetValue: 1000,
        //         assetNotes: '',
        //     },
        //     GOLD: {
        //         assetType: 'Metals',
        //         assetName: 'Gold',
        //         assetAbb: '',
        //         assetQuantity: '1',
        //         assetUnit: 'Oz',
        //         assetValue: 1000,
        //         assetNotes: '',
        //     },
        // }

        let totalValue

        const assetQuantityUnits = [
            { name: 'Stocks', unit: ' pieces' },
            { name: 'Metals', unit: ' Oz' },
            { name: 'Crypto', unit: ' pieces' },
        ];

        const assetAbbs = [
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },
            { name: 'Bitcoin', abb: ' pieces' },

        ];

        //SETUP
        window.addEventListener('load', function () {
            //Load ASSET from localstorage and display them
            ASSETS = JSON.parse(localStorage.getItem("ASSETS"));
            calcTotalValue()
            displayAssets()
        })

        function calcTotalValue() {
            //Calculate and display totalValue of Assets
            totalValue = 0
            for (let singleAsset in ASSETS) {
                totalValue = totalValue + ASSETS[singleAsset].assetValue
            }
            document.querySelector('#total-value').innerHTML = `Total Worth: ${totalValue} €`;
        }

        //display assetForm
        function displayAssetForm() {
            document.querySelector('#assetForm-hidden').setAttribute('id', 'assetForm') //hide assetForm
        }

        //hide assetForm and clear input fields
        function hideAssetForm() {
            document.querySelector('#assetForm').setAttribute('id', 'assetForm-hidden') //hide assetForm
            assetTypeField.value = '';
            assetNameField.value = '';
            assetQuantityField.value = '';
            assetNotesField.value = '';
        }

        //Prepare assetNameField dropdown and assetUnit in Form according to assetTypeField
        function setAssetType() {
            if (document.getElementById("assetTypeField").value === "") {
                displayError('Chose asset type first!')
                return
            }
            const assetType = document.getElementById("assetTypeField").value
            switch (assetType) {
                case 'Stocks':
                    document.querySelector('#assetNameField').setAttribute("list", "Stocks")
                    document.querySelector('#assetQuantityLabel').innerHTML = 'Quantity (Pieces)'
                    break;
                case 'Metals':
                    document.querySelector('#assetNameField').setAttribute("list", "Metals")
                    document.querySelector('#assetQuantityLabel').innerHTML = 'Quantity (Oz)'
                    break;
                case 'Crypto':
                    document.querySelector('#assetNameField').setAttribute("list", "Crypto")
                    document.querySelector('#assetQuantityLabel').innerHTML = 'Quantity (Pieces)'
                    break;
            }
        }


        //Push form input to ASSETS
        function addAsset(form) {
            //Make sure form is filled completely
            if (form.assetTypeField.value === "") {
                displayError('Enter asset type!')
                return
            }
            if (form.assetNameField.value === "") {
                displayError('Enter asset name!')
                return
            }
            if (form.assetTypeField.value === "") {
                displayError('Chose asset type!')
                return
            }
            if (form.assetQuantityField.value === "") {
                displayError('Enter asset quantity!')
                return
            }

            //find assetUnit for assetType
            const thisAssetQuantityUnit = assetQuantityUnits.find(assetUnit => assetUnit.name == form.assetTypeField.value).unit;

            //find assetAbb for assetName


            //find assetBaseValue for assetName


            //calculate assetValue with assetBaseValue and assetQuantity




            //Push asset to ASSETS
            ASSETS[form.assetNameField.value] = { assetType: form.assetTypeField.value, assetName: form.assetNameField.value, assetAbb: "", assetQuantity: form.assetQuantityField.value, assetUnit: thisAssetQuantityUnit, assetValue: "", assetNotes: form.assetNotesField.value }
            displayError('Asset added successfully!')

            updateLocalStorage();
            calcTotalValue();
            hideAssetForm()
            displayAssets();
        }

        function deleteAsset(singleAsset, singleAssetName) {
            if (confirm('Sure, you want to delete Asset "' + singleAssetName + '"?') === false)
                return
            delete ASSETS[singleAsset]
            // alert('löschen...');
            updateLocalStorage();
            calcTotalValue();
            displayAssets();
        }

        function editAsset(singleAsset) {
            alert('edit...', singleAsset);
            updateLocalStorage();
            calcTotalValue();
            hideAssetForm()
            displayAssets();
        }

        function updateLocalStorage() {
            //update ASSETS in localstorage
            let ASSETS_serialized = JSON.stringify(ASSETS);
            localStorage.setItem("ASSETS", ASSETS_serialized)
        }
        //Display error for wrong form inputs
        function displayError(error) {
            document.querySelector('#error').innerHTML = error
        }

        //Display Assets from ASSETS
        function displayAssets() {
            document.querySelector('#asset-list').innerHTML = '';
            for (let singleAsset in ASSETS) {
                // console.log(singleAsset, ASSETS[singleAsset])
                // console.log(ASSETS[singleAsset].assetType)

                document.querySelector('#asset-list').innerHTML += `
                <div class="demo-card-square mdl-card mdl-shadow--2dp ${ASSETS[singleAsset].assetType}">
                    <div class="mdl-card__title mdl-card--expand">
                        <h2 class="mdl-card__title-text">${ASSETS[singleAsset].assetName} (${ASSETS[singleAsset].assetAbb})</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        ${ASSETS[singleAsset].assetQuantity} ${ASSETS[singleAsset].assetUnit}<br>
                        Value: ${ASSETS[singleAsset].assetValue}€<br>
                        Notes: ${ASSETS[singleAsset].assetNotes}
                    </div>
                    <div class="mdl-card__actions mdl-card--border">
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" onclick="editAsset('${singleAsset}', '${ASSETS[singleAsset].assetName}')">
                            edit
                        </a>
                        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" onclick="deleteAsset('${singleAsset}', '${ASSETS[singleAsset].assetName}')">
                            delete
                        </a>
                    </div>
                </div>
                `;

            }
        }

    </script>
</head>

<body>
    <div id="wrapper">
        <h1>Track yo assets!</h1>

        <div id="assetForm-hidden" class="layoutElement">
            <!-- Simple Textfield -->
            <form onsubmit="addAsset(this); return false;">
                <datalist id="assetTypeList">
                    <option value="Crypto">
                    <option value="Stocks">
                    <option value="Metals">
                </datalist>
                <datalist id="Metals">
                    <option value="Gold">
                    <option value="Silver">
                </datalist>
                <datalist id="Stocks">
                    <option value="Apple">
                    <option value="Meta">
                    <option value="Alphabet">
                    <option value="Amazon">
                </datalist>
                <datalist id="Crypto">
                    <option value="Bitcoin">
                    <option value="Ether">
                    <option value="Dogecoin">
                    <option value="Solana">
                </datalist>

                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" list="assetTypeList" id="assetTypeField">
                    <label class="mdl-textfield__label" for="assetTypeField">Type</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" id="assetNameField" onclick="setAssetType()">
                    <label class="mdl-textfield__label" for="assetNameField">Asset</label>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?"
                        id="assetQuantityField">
                    <label class="mdl-textfield__label" for="assetQuantityField"
                        id="assetQuantityLabel">Quantity</label>
                    <span class="mdl-textfield__error">Input is not a number!</span>
                    <span id="assetUnitField"></span>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" id="assetNotesField">
                    <label class="mdl-textfield__label" for="assetNotesField">Notes</label>
                </div>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" type="submit">
                    Save
                </button>
            </form>
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" onclick="hideAssetForm()">
                Cancel
            </button>

        </div>
        <div id="error"></div>

        <div id="assetControls" class="layoutElement">
            <!-- Colored raised button -->
            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored"
                onclick="displayAssetForm()">
                Add Asset
            </button>
            <!-- <div id="assetFilters">
                <span class="mdl-chip mdl-chip--deletable">
                    <span class="mdl-chip__text">Crypto</span>
                    <button type="button" class="mdl-chip__action"><i class="material-icons">cancel</i></button>
                </span>
                <span class="mdl-chip mdl-chip--deletable">
                    <span class="mdl-chip__text">Metal</span>
                    <button type="button" class="mdl-chip__action"><i class="material-icons">cancel</i></button>
                </span>
                <span class="mdl-chip mdl-chip--deletable">
                    <span class="mdl-chip__text">Stocks</span>
                    <button type="button" class="mdl-chip__action"><i class="material-icons">cancel</i></button>
                </span>
            </div> -->
        </div>

        <div id="asset-list" class="layoutElement">
            <!-- <div class="demo-card-square mdl-card mdl-shadow--2dp Crypto">
                <div class="mdl-card__title mdl-card--expand">
                    <h2 class="mdl-card__title-text">Bitcoin (BTC)</h2>
                </div>
                <div class="mdl-card__supporting-text">
                    1 Coin <br>
                    Value: 1000,00€
                </div>
                <div class="mdl-card__actions mdl-card--border">
                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                        edit
                    </a>
                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                        delete
                    </a>
                </div>
            </div>

            <div class="demo-card-square mdl-card mdl-shadow--2dp Stocks">
                <div class="mdl-card__title mdl-card--expand">
                    <h2 class="mdl-card__title-text">Apple (AAPL)</h2>
                </div>
                <div class="mdl-card__supporting-text">
                    1 Stock <br>
                    Value: 1000,00€
                </div>
                <div class="mdl-card__actions mdl-card--border">
                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                        edit
                    </a>
                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                        delete
                    </a>
                </div>
            </div>

            <div class="demo-card-square mdl-card mdl-shadow--2dp Metals">
                <div class="mdl-card__title mdl-card--expand">
                    <h2 class="mdl-card__title-text">Gold</h2>
                </div>
                <div class="mdl-card__supporting-text">
                    1 Ounce <br>
                    1000,00€
                </div>
                <div class="mdl-card__actions mdl-card--border">
                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                        edit
                    </a>
                    <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                        delete
                    </a>
                </div>
            </div> -->
        </div>
        <br clear="all">
        <div id="footer">
            <p id="total-value" class="layoutElement"></p>
            <br>
            <p class="layoutElement">This tools does...</p>
        </div>
    </div>
</body>

</html>